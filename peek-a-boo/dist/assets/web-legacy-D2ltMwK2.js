System.register(["./index-legacy-IwLPgopo.js"],(function(e,t){"use strict";var a,s,r,n,i,o,c,u,d,l,h,b,p,m,y,C,f,F,w,g,Q,M,P,W,v,S,D,A,L;return{setters:[e=>{a=e.W,s=e.am,r=e.an,n=e.ao,i=e.ap,o=e.aq,c=e.ar,u=e.as,d=e.at,l=e.au,h=e.av,b=e.aw,p=e.ax,m=e.ay,y=e.az,C=e.aA,f=e.aB,F=e.aC,w=e.aD,g=e.aE,Q=e.aF,M=e.aG,P=e.aH,W=e.aI,v=e.aJ,S=e.aK,D=e.aL,A=e.aM,L=e.aN}],execute:function(){e("FirebaseFirestoreWeb",class extends a{constructor(){super(...arguments),this.unsubscribesMap=new Map}async addDocument(e){const t=s(),{reference:a,data:i}=e,o=await r(n(t,a),i);return{reference:{id:o.id,path:o.path}}}async setDocument(e){const t=s(),{reference:a,data:r,merge:n}=e;await i(o(t,a),r,{merge:n})}async getDocument(e){const t=s(),{reference:a}=e,r=await c(o(t,a)),n=r.data();return{snapshot:{id:r.id,path:r.ref.path,data:void 0===n?null:n,metadata:{hasPendingWrites:r.metadata.hasPendingWrites,fromCache:r.metadata.fromCache}}}}async updateDocument(e){const t=s(),{reference:a,data:r}=e;await u(o(t,a),r)}async deleteDocument(e){const t=s(),{reference:a}=e;await d(o(t,a))}async writeBatch(e){const t=s(),{operations:a}=e,r=l(t);for(const s of a){const{type:e,reference:a,data:n,options:i}=s,c=o(t,a);switch(e){case"set":r.set(c,n,null!=i?i:{});break;case"update":r.update(c,null!=n?n:{});break;case"delete":r.delete(c)}}await r.commit()}async getCollection(e){const t=await this.buildCollectionQuery(e,"collection");return{snapshots:(await h(t)).docs.map((e=>({id:e.id,path:e.ref.path,data:e.data(),metadata:{hasPendingWrites:e.metadata.hasPendingWrites,fromCache:e.metadata.fromCache}})))}}async getCollectionGroup(e){const t=await this.buildCollectionQuery(e,"collectionGroup");return{snapshots:(await h(t)).docs.map((e=>({id:e.id,path:e.ref.path,data:e.data(),metadata:{hasPendingWrites:e.metadata.hasPendingWrites,fromCache:e.metadata.fromCache}})))}}async getCountFromServer(e){const t=s(),{reference:a}=e,r=n(t,a);return{count:(await b(r)).data().count}}async clearPersistence(){const e=s();await p(e)}async enableNetwork(){const e=s();await m(e)}async disableNetwork(){const e=s();await y(e)}async useEmulator(e){const t=s(),a=e.port||8080;C(t,e.host,a)}async addDocumentSnapshotListener(e,t){const a=s(),r=f(o(a,e.reference),{includeMetadataChanges:e.includeMetadataChanges,source:e.source},(e=>{const a=e.data(),s={snapshot:{id:e.id,path:e.ref.path,data:void 0===a?null:a,metadata:{hasPendingWrites:e.metadata.hasPendingWrites,fromCache:e.metadata.fromCache}}};t(s,void 0)}),(e=>t(null,e))),n=Date.now().toString();return this.unsubscribesMap.set(n,r),n}async addCollectionSnapshotListener(e,t){const a=await this.buildCollectionQuery(e,"collection"),s=f(a,{includeMetadataChanges:e.includeMetadataChanges,source:e.source},(e=>{const a={snapshots:e.docs.map((e=>({id:e.id,path:e.ref.path,data:e.data(),metadata:{hasPendingWrites:e.metadata.hasPendingWrites,fromCache:e.metadata.fromCache}})))};t(a,void 0)}),(e=>t(null,e))),r=Date.now().toString();return this.unsubscribesMap.set(r,s),r}async addCollectionGroupSnapshotListener(e,t){const a=await this.buildCollectionQuery(e,"collectionGroup"),s=f(a,{includeMetadataChanges:e.includeMetadataChanges,source:e.source},(e=>{const a={snapshots:e.docs.map((e=>({id:e.id,path:e.ref.path,data:e.data(),metadata:{hasPendingWrites:e.metadata.hasPendingWrites,fromCache:e.metadata.fromCache}})))};t(a,void 0)}),(e=>t(null,e))),r=Date.now().toString();return this.unsubscribesMap.set(r,s),r}async removeSnapshotListener(e){const t=this.unsubscribesMap.get(e.callbackId);t&&(t(),this.unsubscribesMap.delete(e.callbackId))}async removeAllListeners(){this.unsubscribesMap.forEach((e=>e())),this.unsubscribesMap.clear(),await super.removeAllListeners()}async buildCollectionQuery(e,t){const a=s();let r;if(e.compositeFilter){const s=this.buildFirebaseQueryCompositeFilterConstraint(e.compositeFilter),i=await this.buildFirebaseQueryNonFilterConstraints(e.queryConstraints||[]);r=F("collection"===t?n(a,e.reference):w(a,e.reference),s,...i)}else{const s=await this.buildFirebaseQueryConstraints(e.queryConstraints||[]);r=F("collection"===t?n(a,e.reference):w(a,e.reference),...s)}return r}buildFirebaseQueryCompositeFilterConstraint(e){const t=this.buildFirebaseQueryFilterConstraints(e.queryConstraints);return"and"===e.type?g(...t):Q(...t)}buildFirebaseQueryFilterConstraints(e){const t=[];for(const a of e){const e=this.buildFirebaseQueryFilterConstraint(a);t.push(e)}return t}buildFirebaseQueryFilterConstraint(e){return"where"===e.type?this.buildFirebaseQueryFieldFilterConstraint(e):this.buildFirebaseQueryCompositeFilterConstraint(e)}buildFirebaseQueryFieldFilterConstraint(e){return M(e.fieldPath,e.opStr,e.value)}async buildFirebaseQueryNonFilterConstraints(e){const t=[];for(const a of e){const e=await this.buildFirebaseQueryNonFilterConstraint(a);t.push(e)}return t}async buildFirebaseQueryNonFilterConstraint(e){switch(e.type){case"orderBy":return L(e.fieldPath,e.directionStr);case"limit":return A(e.limit);case"limitToLast":return D(e.limit);case"startAt":case"startAfter":case"endAt":case"endBefore":{const t=s(),a=await c(o(t,e.reference));switch(e.type){case"startAt":return S(a);case"startAfter":return v(a);case"endAt":return W(a);case"endBefore":return P(a)}}}}async buildFirebaseQueryConstraints(e){const t=[];for(const a of e){const e=await this.buildFirebaseQueryConstraint(a);t.push(e)}return t}async buildFirebaseQueryConstraint(e){return"where"===e.type?this.buildFirebaseQueryFieldFilterConstraint(e):await this.buildFirebaseQueryNonFilterConstraint(e)}})}}}));
